# vim: set syn=yaml:

box: wercker/nodejs
build:
  # as existing wercker.yml
  steps:
    - script:
        name: Echo a message just to show something in logs
        code: |-
          echo "Hello, world"

deploy:
  steps:
    - script:
        name: Install Ansible to handle deployment
        code: |-
          sudo apt-get install python-software-properties
          sudo add-apt-repository ppa:ansible/ansible -y
          sudo apt-get update -y
          sudo apt-get install -y ansible

    - script:
        name: Checkout our Ansible repository
        code: |-
          ansible -ilocalhost, localhost -c local -m git -a 'repo=git@bitbucket.org:flyvictor/ansible-code dest=ansible'

    # manipulate the inventory depending on branch?
    - script:
        name: Running Ansible to deploy
        cwd: ansible
        code: |-
          echo $VAULT_PASSWORD | ansible-playbook -i inventory/develop deploy-service.yml --vault-password-file=/bin/cat --list-tasks --list-hosts 

